---
title: "CHIC402/CHIC602 Coursework 2 - Variant Analysis"
author: 36 ...
fontsize: 12pt
geometry: margin = 0.85in
output: 
  pdf_document:
    number_sections: true
header-includes:
- \usepackage{subcaption}
---


<!--- Global Settings --->
```{r include = FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

<!--- Libraries --->
```{r include = FALSE}
library(dplyr)
library(ggplot2)
library(stringr)
```

<!--- External Functions
VariantsData: Reads-in and inspects the data of variant_travel.csv
GraphsDelta: For Section 3.1a
VariantsProportions:
--->
```{r include = FALSE}
sys.source(file = 'R/functions/VariantsData.R', envir = knitr::knit_global())
sys.source(file = 'R/functions/GraphsDelta.R', envir = knitr::knit_global())
sys.source(file = 'R/functions/VariantsProportions.R', envir = knitr::knit_global())
sys.source(file = 'R/functions/GraphsPredominant.R', envir = knitr::knit_global())
```

<!--- The data --->
```{r include = FALSE}
variants <- VariantsData()
melted <- variants %>%
        tidyr::gather(key = 'variant', value = 'fraction', -c(week, travel))

starting <- min(variants$week)
ending <- max(variants$week)
```


\textcolor[rgb]{0.3, 0.3, 0.3}{This project focuses on the analysis of the United Kingdom's genetically-typed SARS-CoV-2 infections data.  The data set summarises the weekly infections fractions of $17$ SARS-CoV-2 variants, starting $`r starting`$, and ending $`r ending`$; additionally, there's the field `Other`, each value of this field represents a pooled fraction w.r.t. (with respect to) an unknown number of unnamed variants.}

\vspace{35pt}

# The Data

The variants' data is read-in and inspected via function $DataGet(\;)$, and stored in the data frame variable **variants**.  The variable **melted** stores the melted form of **variants**.  The number of instances, and the features, of **variants**  are

\vspace{10pt}

\footnotesize

```{r comment = '         '}
# the description of the variants data set stored in variable variants
str(variants, vec.len = 3)
```

\normalsize

\vspace{10pt}

Infection proportion statistics, by variant, are calculated by function $VariantsProportions(\;)$, and summarised in named-list variable **proportions**. The contents of **proportions** are discussed in detail at appropriate points in this document.  In brief, **proportions** consists of four data frames: *none*, *travel*, *leading*, *leadingseries*.  The data frame *none* summarises the total contribution of each variant w.r.t. that data's time span ($`r starting` \rightarrow `r ending`$); similarly for *travel*.  The data frame *leading* lists the 5 variants responsible for the most infections (w.r.t. travel & non-travel) during the data's time span; *leadingseries* stores the infections' data of these five.

```{r include = FALSE}
proportions <- VariantsProportions(melted = melted)
```

\vspace{35pt}

# An Exploration of Non-travel Data

Each variant's weekly data consists of two records.  One represents the infections-fraction associated with known travel links (denoted *travel* in field $travel$), whilst the other represents the infections-fraction without known travel links (denoted *none* in field $travel$).  This section focuses on non-travel data, and the variable **local** stores the applicable data.  The truncated data description highlights the number of non-travel data records.

```{r}
# 3.0
# The non-travel data only
local <- variants %>%
        dplyr::filter(travel == 'none')
```

\vspace{10pt}

\footnotesize

```{r size = 'tiny', comment = '          '}
# A preview of variable 'local'
str(local, vec.len = 3, list.len = 5)
```

\normalsize

\vspace{20pt}

## The Progression of Delta

A variant of interest, amongst the variants that contribute to the non-travel infections quantities, is the **Delta** variant.  During the data's time span the largest proportion of non-travel infections was due to the Delta variant.

\vspace{10pt}

\footnotesize

```{r }
knitr::kable(x = head(proportions$none), caption = 'The variants responsible for the 5 largest non-travel infections proportion')
```

\normalsize

\vspace{10pt}

```{r include = FALSE}
maxima <- local[which.max(local$Delta), c('week', 'Delta')]
```

The graph of $fig. \: \ldots$ illustrates the weekly progression of Delta variant infections over time.  Each week's Delta fraction
is a fraction of the week's total non-travel infections due to all recorded variants; named & `Other`.  Delta's
fractions peak at `r round(first(x = maxima$Delta), digits = 3)` on `r first(x = maxima$week)`; hereafter, it seems that the Delta fraction values are continuously, but slowly, declining.

<!--- Weekly Delta fractions over time --->
```{r fig.align = 'center', out.height = '65%', dpi = 85, fig.cap = 'The Weekly Non-Travel Delta Variant Infections Fractions Over Time'}
# 3.1.a
GraphsDelta(local = local)
```

\vspace{20pt}

## Variant Peaks

```{r include = FALSE}
peaks <- local %>%
        select(!(travel)) %>%
        tidyr::gather(key = 'variant', value = 'p', -week) %>%
        group_by(variant) %>%
        slice(which.max(p)) %>%
        arrange(desc(p))
```

In general, each variant has a fraction peak date w.r.t. the

* data time span: *`r starting`* $\rightarrow$ $`r ending`$
* non-travel data

The peak date of each variant, in descending peak-date--fraction order, is^[Note: `Other` is not a variant, it represents a collection of variants, therefore excluded.]

\footnotesize

```{r}
# the variants and their peak dates
knitr::kable(x = peaks[, c('variant', 'week', 'p')],
             col.names = c('Variant', 'Peak Date', 'Peak Date Fraction'),
             format = 'simple',
             digits = 3,
             caption = 'The variants responsible for the largest peak date fractions; w.r.t. data time span & non-travel data')
```

\normalsize

\vspace{35pt}

# Variant Proportions by Known/Unknown Travel Links

During the whole data time span, the five variants responsible for the five largest variant-infection--proportions, w.r.t. known & unknown travel links, are

\footnotesize

```{r}
knitr::kable(x = proportions$leading, format = 'simple', col.names = c('Variant', 'Proportion'),
             caption = 'The variants responsible for the five largest variant-infection--proportions w.r.t. entire data time span')
```

\normalsize

\vspace{20pt}

## The Predominant Variants

The time series of each variant of $table \: \ldots$ is illustrated in $fig. \: \ldots$

```{r out.width = '55%', fig.show = 'hold', fig.align = 'center', fig.subcap = c('original', 'zoom')}
PredominantVariants(predominant = proportions$leadingseries)
PredominantVariantsZoom(predominant = proportions$leadingseries)
```
